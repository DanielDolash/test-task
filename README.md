# test-task
## Предварительная подготовка
Для работы тестового стенда необходимо установить
- vagrant
- ansible >= 2.10
- virtualbox

Также необходимо установить зависимости проекта:
```bash
ansible-galaxy install -r requirements.yml
```
## Запуск
1. Vagrantfile по команде `Vagrant up` запускает Ubuntu 20.04  и конфигурирует сетевые интерфейсы внутри ВМ, а также пробрасывает папку с файлами Docker в виртуальную машину
> При работе можно использовать средства Vagrant, позволяющие получить образ Ubuntu 20.04 автоматически, 
> но хранилище [Vagrant](https://app.vagrantup.com/generic/) не доступно для загрузки файлов на данный момент. 
Файл необходимо загрузить вручную и выполнить команду для добавления образа.
```bash
vagrant box add <имя локального файла> --name generic/ubuntu2004
```
2. Vagrantfile передает на исполнение виртуальной машине ansible-скрипт, который устанавливает `docker`, `docker-compose`, `prometheus-node-exporter` и запускает `docker-compose`

## Состав докер-контейнеров
Docker-compose собирает и запускает 2 докер-контейнера:
- С помощью Dockerfile загружает и запускает `Prometheus`, копирует конфигурационный файл в контейнер с `Prometheus`, который позволяет настроить его на сбор метрик с виртуальной машины по порту 9100 (метрики предоставляет `prometheus-node-exporter`), используя внутренний интерфейс Docker с адресом `172.17.0.1`
- С помощью Dockerfile загружает и запускает `Grafana`, копирует предварительно скачанный шаблон Dashboard(ID 1860), конфигурационный файл настройки Dashboard и Datasource (В качестве которого используется `Prometheus`). `Grafana` предоставляет доступ по порту 3000 для просмотра DashBoard

## Результат
Таким образом при обращении к хосту через браузер по порту 3000, открывается `Grafana`, предоставляющая Dashboard с метриками, собранными с Ubuntu 20.04.
```sh
http://127.0.0.1:3000
```
